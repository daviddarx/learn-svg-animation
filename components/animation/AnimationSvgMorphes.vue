<template>
  <div class="gsap-morphes">
    <h2>SVG morphes</h2>
    <br />

    <div class="container">
      <svg
        width="220"
        height="220"
        viewBox="-20 -20 260 260"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        @click="play"
      >
        <path
          ref="swiss"
          class="morph-swiss"
          d="M35.0447 141.519L34 143.602L42.2828 142.263L46.163 139.064L44.7452 135.866V132.742L48.9985 130.138L57.1321 127.609L63.2509 130.138L61.3108 133.634L65.4148 136.833L62.8031 139.064L62.2062 143.23L65.4148 144.42V147.916L66.8326 147.173L68.4742 148.883L69.2204 152.082L73.9961 158.107L77.7271 154.76H82.5773L86.6068 151.338H92.054L92.9494 153.272L97.5012 154.76L100.188 153.272L98.6951 152.082V150.446H102.575L104.366 146.28H107.948V140.106L106.829 138.395L106.232 135.866H109.813L112.425 127.609H117.872L118.693 132.146L117.126 135.866L124.14 143.602L129.364 145.09L130.558 147.173L129.364 148.883V150.446H130.558L134.139 154.76V158.107L136.602 159L138.84 156.768L139.736 153.942L137.497 151.338L138.84 146.28L144.362 140.106L145.78 132.146V125.526H151.153V130.659L153.391 134.378L158.988 135.866L160.48 132.742L166.599 130.659L169.211 132.146V135.196L169.957 137.8L173.016 139.064L175.852 137.8V134.378L173.539 132.742L173.016 130.659H175.852V127.609H171.673L170.852 123.666L173.016 118.98L177.12 117.641L177.941 120.468L178.837 122.327H182.269L186 121.435V117.641L182.269 117.12L183.015 112.657L185.403 104.326L183.761 101.648L180.851 100.012L177.941 103.433L175.852 106.186L173.016 108.045L165.032 103.433V100.012L160.48 98.3006H155.257L156.152 93.3911L153.391 87.9609L157.57 83.6465V78.5138L145.78 69.7362L136.602 67.8765L132.946 69.7362H130.558V66.6863L120.559 62L116.156 65.6449L115.111 69.7362L119.589 71.0752L117.872 73.9018H113.321L109.813 72.1166L106.232 73.9018L100.188 74.7945L98.6951 73.9018L95.4865 74.7945L92.054 75.7615V72.786L86.6068 73.9018L85.786 77.1005H83.2489V80.2991L76.757 80.9686L75.8616 77.1005H70.3397L65.4148 84.911C66.9321 84.787 70.2054 84.6135 71.1605 84.911C72.1157 85.2086 65.9869 91.4818 62.8031 94.5813L58.4752 100.904L50.7894 104.326V109.756V112.657L39.4472 121.435L40.4173 124.41C39.7208 125.303 38.2533 127.192 37.9548 127.609C37.6564 128.025 38.8254 129.221 39.4472 129.766L41.3127 132.146L39.4472 135.866V137.8L34 139.064L35.0447 141.519Z"
          fill="black"
        />
        <path
          ref="blob"
          class="morph-blob"
          d="M98.0046 9.23134C118.475 -1.89942 88.733 66.0637 112.005 67.2313C133.314 68.3005 129.279 2.47512 140.505 20.6192C146.621 30.5051 133.66 42.1352 141.881 50.3554C150.101 58.5756 165.804 41.6637 171.617 51.7313C177.429 61.799 148.384 65.0023 151.392 76.2314C154.401 87.4604 219.005 79.1062 219.005 90.7314C219.005 102.356 139.013 90.0023 136.005 101.231C132.996 112.46 206.817 133.664 201.005 143.731C195.192 153.799 159.613 142.011 151.392 150.231C143.172 158.452 136.96 137.919 126.892 143.731C116.825 149.544 134.621 175.723 123.392 178.731C112.163 181.74 109.63 212.731 98.0046 212.731C86.3795 212.731 93.1739 157.176 81.9449 154.167C70.7159 151.158 65.5723 173.656 55.5046 167.843C45.437 162.031 103.613 128.452 95.3924 120.231C87.1722 112.011 30.205 146.799 24.3925 136.731C18.5799 126.664 64.0134 114.46 61.0046 103.231C57.9958 92.0023 13.0046 105.856 13.0046 94.2313C13.0046 82.6062 35.0601 89.4006 38.0689 78.1716C41.0777 66.9426 -5.30798 58.299 0.504583 48.2314C6.31715 38.1637 54.7844 70.9516 63.0046 62.7314C71.2248 54.5111 45.437 26.4317 55.5046 20.6192C65.5723 14.8066 70.7159 37.3045 81.9449 34.2956C93.1739 31.2868 87.7917 14.7846 98.0046 9.23134Z"
          fill="black"
        />
        <path
          ref="star"
          class="morph-star"
          d="M110 25L126.06 50.0643L152.5 36.3878L153.876 66.124L183.612 67.5L169.936 93.9403L195 110L169.936 126.06L183.612 152.5L153.876 153.876L152.5 183.612L126.06 169.936L110 195L93.9403 169.936L67.5 183.612L66.124 153.876L36.3878 152.5L50.0643 126.06L25 110L50.0643 93.9403L36.3878 67.5L66.124 66.124L67.5 36.3878L93.9403 50.0643L110 25Z"
          fill="black"
        />
      </svg>
      <input
        ref="timelineRange"
        class="slider"
        type="range"
        min="1"
        max="100"
        value="0"
        @input="rangeTimeline"
      />
    </div>
  </div>
</template>

<script>
import { gsap } from 'gsap'
import { MorphSVGPlugin } from 'gsap/dist/MorphSVGPlugin.js'

gsap.registerPlugin(MorphSVGPlugin)

export default {
  name: 'AnimationSvgMorphes',
  data() {
    return {
      tl: undefined,
    }
  },
  mounted() {
    this.initTL()
  },
  beforeDestroy() {
    this.timeline.kill()
  },
  methods: {
    linesTL() {
      const tl = gsap
        .timeline()
        .to(this.$refs.star, {
          morphSVG: this.$refs.blob,
          duration: 1,
          delay: 0.5,
          ease: 'elastic.out(1, 0.3)',
        })
        .to(this.$refs.star, {
          morphSVG: this.$refs.swiss,
          duration: 1,
          delay: 0.5,
          ease: 'power4.inOut',
        })
        .to(this.$refs.star, {
          morphSVG: this.$refs.star,
          duration: 1,
          type: 'rational',
          delay: 0.5,
          ease: 'power4.inOut',
        })
      return tl
    },
    initTL() {
      this.timeline = gsap
        .timeline({
          repeat: -1,
          yoyo: true,
        })
        .eventCallback('onUpdate', this.updateTimelineRange)

      this.timeline.add(this.linesTL())

      // debugging
      // this.timeline.timeScale(0.5)
    },
    rangeTimeline() {
      this.timeline
        .pause()
        .seek((this.timeline.duration() * this.$refs.timelineRange.value) / 100)
    },
    updateTimelineRange() {
      this.$refs.timelineRange.value = this.timeline.progress() * 100
    },
    play() {
      if (this.timeline.isActive()) {
        this.timeline.pause()
      } else {
        this.timeline.play()
      }
    },
  },
}
</script>

<style lang="postcss" scoped>
.container {
  @apply flex flex-col items-center justify-center;
}
svg {
  @apply w-full md:w-1/2 h-auto;
  @apply cursor-pointer;
}
.slider {
  @apply mb-4 mt-8;
}
.morph-blob,
.morph-swiss {
  @apply hidden;
}
</style>
